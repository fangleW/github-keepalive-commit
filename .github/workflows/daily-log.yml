# .github/workflows/daily-log.yml
name: Daily Log

on:
  schedule:
    - cron: '0 1 * * *'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  daily-log:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Environment
        run: |
          git config user.name "${{ github.actor }}"
          git config user.email "${{ github.actor }}@users.noreply.github.com"

      - name: Create Daily Log
        run: |
          # è®¾ç½®æ—¶åŒº
          export TZ='Asia/Shanghai'
          
          DATE=$(date '+%Y-%m-%d')
          YEAR=$(date '+%Y')
          MONTH=$(date '+%m')
          DAY_OF_YEAR=$(date '+%j')
          WEEK=$(date '+%V')
          WEEKDAY=$(date '+%A')
          
          # åˆ›å»ºç›®å½•ç»“æ„
          mkdir -p "logs/$YEAR/$MONTH"
          
          # ç”Ÿæˆæ—¥å¿—å†…å®¹
          cat > "logs/$YEAR/$MONTH/$DATE.md" << EOF
          # ğŸ“… $DATE ($WEEKDAY)
          
          ## ğŸ“Š ä»Šæ—¥ç»Ÿè®¡
          - ğŸ—“ï¸ ä»Šå¹´ç¬¬ $DAY_OF_YEAR å¤©
          - ğŸ“… ç¬¬ $WEEK å‘¨
          - â° è®°å½•æ—¶é—´: $(date '+%H:%M:%S')
          
          
          ## ğŸ“ å¤‡æ³¨
          è‡ªåŠ¨ç”Ÿæˆäº GitHub Actions
          EOF
          
          # æ›´æ–° README ç»Ÿè®¡
          echo "Last updated: $DATE $(date '+%H:%M:%S')" > README.md
          echo "" >> README.md
          echo "Total logs: $(find logs -name "*.md" | wc -l)" >> README.md

      - name: Commit and Push
        run: |
          git add -A
          git diff-index --quiet HEAD || git commit -m "ğŸ“ Daily log: $(date '+%Y-%m-%d')"
          git push
